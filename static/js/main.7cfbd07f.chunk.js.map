{"version":3,"sources":["qrcode.png","App.js","serviceWorker.js","index.js"],"names":["module","exports","web3","Web3","subspace","Subspace","dai","eth","Contract","exchangeABI","daiContract","contract","init","AppBar","props","Box","tag","direction","align","alignContent","background","pad","left","right","vertical","elevation","style","zIndex","Tradelist","DataTable","columns","property","header","Text","weight","primary","data","last5","App","useState","txnObserver","setObservable","last5Observer","setLast5Observer","latestBlock","setBlock","setLast5","TradeDetails","tokensSold","ethBought","this","utils","fromWei","exchangeRate","useEffect","getBlockNumber","then","block","EthPurchased$","events","EthPurchase","track","fromBlock","last5$","pipe","$latest","undefined","subscribe","trade","unsubscribe","fiveTrades","prices","map","txnDetails","tokens_sold","eth_bought","buyer","rate","Grommet","PiedPiper","color","size","margin","textAlign","reduce","a","b","length","toFixed","Image","src","require","Boolean","window","location","hostname","match","ReactDOM","render","StrictMode","document","getElementById","navigator","serviceWorker","ready","registration","unregister","catch","error","console","message"],"mappings":"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","file":"static/js/main.7cfbd07f.chunk.js","sourcesContent":["module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADIAQMAAACXljzdAAAABlBMVEX///9GwjD+wKdsAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABMElEQVRYw+2XvQ2EMAyFHVGkZISMwmb8bMYoGYEyBYrv2TnBcVx9doEVkOBrQuz3bIieeOK/wRJrxxw4U5SH6obsuPqVaOBCFDOeRj+k572XXcu7mCfO3gjuobglayV/RLPd8YpUjz/qwJI0lciuhdz1Y0ladBtV3fItLAlvBIngRKFgnOVUHJEG1WDSUhJOdPZDRCXM2yB5jgxYPRFYstyj1GAoh0rsibYyVbC6y0XBfol8DA3qiVIHM6XZDRHloMmhRqPUAZ914IBsAxZcG74zlbScvcQDodbn4DuTSCiTG3JYT9AuMt6mUkPS+pwu6cHjdw+2JG0+2MV90nXXDsg5j6Zm2dUZ0aNtc1VySIJqN3xPqqZEsw2ViILLZ8LtyXse1X8zDFWXHmxNnnjCPl7csoO31tQFpwAAAABJRU5ErkJggg==\"","import React, { useEffect, useState } from 'react';\nimport { Box, Grommet, DataTable, Text, Image } from 'grommet';\nimport { PiedPiper } from 'grommet-icons';\nimport { pipe } from 'rxjs';\nimport Subspace, { $latest } from '@embarklabs/subspace';\nimport Web3 from 'web3';\nimport exchangeABI from './contracts/exchange_abi.json';\n\n//const web3 = new Web3('https://cloudflare-eth.com');\nconst web3 = new Web3(\n\t'https://mainnet.infura.io/v3/a0fa183dda3645a28c90e97094224e2f'\n);\n\nconst subspace = new Subspace(web3);\nvar dai = new web3.eth.Contract(\n\texchangeABI,\n\t'0x2a1530C4C41db0B0b2bB646CB5Eb1A67b7158667'\n);\nconst daiContract = subspace.contract(dai);\nsubspace.init();\n\nfunction App() {\n\tconst [txnObserver, setObservable] = useState();\n\tconst [last5Observer, setLast5Observer] = useState();\n\tconst [latestBlock, setBlock] = useState();\n\tconst [last5, setLast5] = useState([]);\n\n\t// Trade details object for calculating exchange rate\n\tfunction TradeDetails(tokensSold, ethBought) {\n\t\tthis.tokensSold = web3.utils.fromWei(tokensSold);\n\t\tthis.ethBought = web3.utils.fromWei(ethBought);\n\t\tthis.exchangeRate = this.tokensSold / this.ethBought;\n\t}\n\n\t// Effect hook to define subspace observables\n\tuseEffect(() => {\n\t\tweb3.eth.getBlockNumber().then(block => setBlock(block));\n\t\tif (typeof latestBlock != 'number') return;\n\n\t\tconst EthPurchased$ = daiContract.events.EthPurchase.track({\n\t\t\tfromBlock: latestBlock - 50\n\t\t});\n\t\tconst last5$ = EthPurchased$.pipe($latest(5));\n\t\tsetObservable(EthPurchased$);\n\t\tsetLast5Observer(last5$);\n\t}, [setObservable, setLast5Observer, latestBlock]);\n\n\t// Effect hook to set up subscription for Uniswap DAI Contract EthPurchase event\n\tuseEffect(() => {\n\t\tif (txnObserver === undefined || typeof latestBlock != 'number') {\n\t\t\treturn;\n\t\t} else {\n\t\t\ttxnObserver.subscribe(trade => {\n\t\t\t\t//console.log(trade);\n\t\t\t});\n\t\t}\n\t\treturn txnObserver.unsubscribe;\n\t}, [txnObserver, latestBlock]);\n\n\t// Effect hook to source last 5 trades from EthPurchase observable\n\tuseEffect(() => {\n\t\tif (last5Observer === undefined) {\n\t\t\treturn;\n\t\t} else {\n\t\t\tlast5Observer.subscribe(fiveTrades => {\n\t\t\t\tconst prices = fiveTrades.map(trade => {\n\t\t\t\t\tconst txnDetails = new TradeDetails(\n\t\t\t\t\t\ttrade.tokens_sold,\n\t\t\t\t\t\ttrade.eth_bought\n\t\t\t\t\t);\n\t\t\t\t\treturn {\n\t\t\t\t\t\t//block: trade.blockNumber,\n\t\t\t\t\t\tblock: trade.buyer,\n\t\t\t\t\t\trate: txnDetails.exchangeRate,\n\t\t\t\t\t\tethBought: txnDetails.ethBought,\n\t\t\t\t\t\ttokensSold: txnDetails.tokensSold\n\t\t\t\t\t};\n\t\t\t\t});\n\t\t\t\tsetLast5(prices);\n\t\t\t});\n\t\t}\n\t\treturn last5Observer.unsubscribe;\n\t}, [last5Observer]);\n\n\treturn (\n\t\t<Grommet>\n\t\t\t<AppBar>Pied Piper DeFi App - Subspace Demo</AppBar>\n\t\t\t<Box align='center'>\n\t\t\t\t<PiedPiper color='plain' size='xlarge' />\n\t\t\t\t<Text margin='medium' textAlign='center'>\n\t\t\t\t\tAverage Exchange Rate on 5 latest Uniswap DAI -> ETH trades ={' '}\n\t\t\t\t\t{(last5.reduce((a, b) => a + b.rate, 0) / last5.length).toFixed(6)}\n\t\t\t\t</Text>\n\t\t\t</Box>\n\t\t\t<Tradelist last5={last5} />\n\t\t\t<br />\n\t\t\t<br />\n\t\t\t<Box align='center'>\n\t\t\t\t<Image src={require('./qrcode.png')} />\n\t\t\t</Box>\n\t\t</Grommet>\n\t);\n}\n\nconst AppBar = props => (\n\t<Box\n\t\ttag='header'\n\t\tdirection='row'\n\t\talign='center'\n\t\talignContent='center'\n\t\tbackground='neutral-1'\n\t\tpad={{\n\t\t\tleft: 'medium',\n\t\t\tright: 'small',\n\t\t\tvertical: 'small'\n\t\t}}\n\t\televation='medium'\n\t\tstyle={{ zIndex: '1' }}\n\t\t{...props}\n\t/>\n);\n\nconst Tradelist = props => (\n\t<Box direction='column' align='center' pad='medium'>\n\t\t<DataTable\n\t\t\tcolumns={[\n\t\t\t\t{\n\t\t\t\t\tproperty: 'block',\n\t\t\t\t\theader: <Text weight='bold'>Buyer</Text>\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tproperty: 'ethBought',\n\t\t\t\t\theader: <Text>ETH Bought</Text>\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tproperty: 'tokensSold',\n\t\t\t\t\theader: <Text>DAI Tokens Sold</Text>\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tproperty: 'rate',\n\t\t\t\t\theader: <Text>ETH ---> DAI Exchange Rate</Text>,\n\t\t\t\t\tprimary: true\n\t\t\t\t}\n\t\t\t]}\n\t\t\tdata={props.last5}\n\t\t/>\n\t</Box>\n);\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}